<html><head><script type="text/javascript">
var add_url = "https://1m7vgd21ee.execute-api.us-east-2.amazonaws.com/Alpha/schedule";

function showSchedule(startdate, enddate, daystarthour, dayendhour, slotlength){
  document.getElementById("schedule").innerHTML = "";

  var table = document.getElementById("schedule");
  var header = table.createTHead();
  var row = header.insertRow(0);
  var timeh = row.insertCell(0);
  timeh.innerHTML = "<b>Meeting Times</b>";
  var day;

  var date = new Date(startdate+"T"+daystarthour+"Z");
  //console.log(date.toUTCString());
  var date2 = new Date(enddate+"T"+dayendhour+"Z");
  //console.log(date2.toUTCString());
  var DOWdate = new Date(startdate+"T"+daystarthour+"Z");
  // Days of the Week at the top of the table
  for(var i=0;i<8;i++){
    day = row.insertCell(i+1);
    DOWdate.setDate(date.getDate()+i);
    var string = DOWdate.toUTCString().slice(0, 12);
    day.innerHTML = "<b>" + string + "</b>";
  }

  // Insert rows for every meeting slot
  var slot;
  date = new Date(startdate+"T"+daystarthour+"Z");
  //console.log(date.toUTCString());
  date2 = new Date(startdate+"T"+dayendhour+"Z");
  var meetingStartDate = new Date(startdate+"T"+daystarthour+"Z");
  var meetingEndDate = new Date(startdate+"T"+daystarthour+"Z");
  var numcolumns = parseInt((date.getTime()-date2.getTime())/(slotlength*60000));
  for(var i=0;i<Math.abs(numcolumns);i++){
    row = table.insertRow();
    slot = row.insertCell(0);

    var meetingStart = date.getTime()+((slotlength*60000)*i);
    var meetingEnd = date.getTime()+((slotlength*60000)*(i+1));

    meetingStartDate.setTime(meetingStart);
    //console.log(meetingStartDate.toUTCString());
    meetingEndDate.setTime(meetingEnd);
    //console.log(meetingEndDate.toUTCString());
    slot.innerHTML = "<b>" + meetingStartDate.toUTCString().slice(17,25) + " - " + meetingEndDate.toUTCString().slice(17,25) + "</b>";
  }

}


function createSchedule(e) {
  var form = document.addForm;
  var startdate = form.startdate.value;
  var enddate = form.enddate.value;
  var daystarthour = form.daystarthour.value;
  var dayendhour = form.dayendhour.value;
  var organizer = form.organizer.value;
  var slotlength = form.slotlength.value;

  var data = {};
  data["startdate"] = startdate;
  data["enddate"] = enddate;
  data["daystarthour"] = daystarthour;
  data["dayendhour"] = dayendhour;
  data["organizer"] = organizer;

  var js = JSON.stringify(data);
  console.log("JS:" + js);
  var xhr = new XMLHttpRequest();
  xhr.open("POST", add_url, true);

  // send the collected data as JSON
  xhr.send(js);

  // This will process results and update HTML as appropriate.
  xhr.onloadend = function () {
    console.log(xhr);
    console.log(xhr.request);
    if (xhr.readyState == XMLHttpRequest.DONE) {
      console.log ("XHR:" + xhr.responseText);
      if(xhr.status == 200){
        showSchedule(startdate, enddate, daystarthour, dayendhour, slotlength);
      }
      var js = JSON.parse(xhr.responseText);
    }
  };
}

</script></head><body>

<h1>Request to create a calendar </h1>

<form name="addForm" method="post" name="addValues">
  Start date (YYYY-MM-DD): <input name="startdate" value="" /><br>
  End date (YYYY-MM-DD): <input name="enddate" value="" /><br>
  Start time for each day (HH:MM:SS): <input name="daystarthour" value="" /><br>
  End time for each day (HH:MM:SS): <input name="dayendhour" value="" /><br>
  Meeting Length (minutes): <input name="slotlength" value="" /><br>
  Your name: <input name="organizer" value="" /><br>
  <input type="button" value="Submit"  onClick="JavaScript:createSchedule(this)">
</form>

<h3>Response Text:</h3>

<div id="message">
</div>

<h3>Schedule</h3>

<table id="schedule" border="black">
</table>

</body>
</html>
